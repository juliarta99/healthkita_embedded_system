<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Detail</title>
    <style>
        :root {
            --primary-color: #57CC99;
            --text-color: #212121;
            --bg-color: #FBFBFB;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --success-color: #00b894;
            --warning-color: #ff9800;
            --danger-color: #ff6b6b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
            background: var(--bg-color);
            padding: 20px;
        }
        
        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .back-btn {
            background: var(--primary-color);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 20px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .patient-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .patient-info {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .patient-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .patient-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .patient-details h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        
        .patient-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            color: #666;
        }
        
        .patient-meta div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .vital-signs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .vital-card {
            background: var(--bg-color);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }
        
        .vital-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
        }
        
        .vital-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
        }
        
        .vital-unit {
            font-size: 11px;
            color: #999;
            margin-left: 4px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .add-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .add-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .schedule-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .schedule-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary-color);
        }
        
        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .medication-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
        }
        
        .diagnosis {
            font-size: 12px;
            color: #666;
            background: var(--bg-color);
            padding: 4px 10px;
            border-radius: 6px;
            display: inline-block;
        }
        
        .schedule-time {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .schedule-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .detail-badge {
            background: var(--bg-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-color);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        @media (max-width: 768px) {
            .patient-info {
                flex-direction: column;
            }
            
            .vital-signs {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="navigateBack()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path fill="#ffff" d="M73.4 297.4C60.9 309.9 60.9 330.2 73.4 342.7L233.4 502.7C245.9 515.2 266.2 515.2 278.7 502.7C291.2 490.2 291.2 469.9 278.7 457.4L173.3 352L544 352C561.7 352 576 337.7 576 320C576 302.3 561.7 288 544 288L173.3 288L278.7 182.6C291.2 170.1 291.2 149.8 278.7 137.3C266.2 124.8 245.9 124.8 233.4 137.3L73.4 297.3z"/></svg>
        </button>
        <h1>Patient Detail</h1>
    </div>
    
    <div class="patient-card">
        <div class="patient-info">
            <div class="patient-photo">
                <img id="patientPhoto" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150" alt="Patient">
            </div>
            <div class="patient-details">
                <h2 id="patientName">Wayan Bagus</h2>
                <div class="patient-meta" id="patientMeta">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M224.2 89C216.3 70.1 195.7 60.1 176.1 65.4L170.6 66.9C106 84.5 50.8 147.1 66.9 223.3C104 398.3 241.7 536 416.7 573.1C493 589.3 555.5 534 573.1 469.4L574.6 463.9C580 444.2 569.9 423.6 551.1 415.8L453.8 375.3C437.3 368.4 418.2 373.2 406.8 387.1L368.2 434.3C297.9 399.4 241.3 341 208.8 269.3L253 233.3C266.9 222 271.6 202.9 264.8 186.3L224.2 89z"/></svg>
                        +62 896-0588-0609
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/></svg>
                        29.09.2006
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M128 252.6C128 148.4 214 64 320 64C426 64 512 148.4 512 252.6C512 371.9 391.8 514.9 341.6 569.4C329.8 582.2 310.1 582.2 298.3 569.4C248.1 514.9 127.9 371.9 127.9 252.6zM320 320C355.3 320 384 291.3 384 256C384 220.7 355.3 192 320 192C284.7 192 256 220.7 256 256C256 291.3 284.7 320 320 320z"/></svg>
                        72129 Bartoletti Highway, 4
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
                        wBagus@gmail.com
                    </div>
                </div>
            </div>
        </div>
        
        <div class="vital-signs">
            <div class="vital-card">
                <div class="vital-label">BMI</div>
                <div class="vital-value">25<span class="vital-unit">kg/mÂ²</span></div>
            </div>
            <div class="vital-card">
                <div class="vital-label">Heart Rate</div>
                <div class="vital-value">72<span class="vital-unit">bpm</span></div>
            </div>
            <div class="vital-card">
                <div class="vital-label">SpO2</div>
                <div class="vital-value">96<span class="vital-unit">%</span></div>
            </div>
            <div class="vital-card">
                <div class="vital-label">Blood Pressure</div>
                <div class="vital-value" style="font-size: 18px;">120/80</div>
            </div>
        </div>
    </div>
    
    <div class="section-header">
        <h2 class="section-title">Medication Schedule</h2>
        <button class="add-btn" onclick="navigateToAddPrescription()">
            <span>+</span>
            <span>Add Prescription</span>
        </button>
    </div>
    
    <div class="schedule-list" id="scheduleList">
        <!-- Schedules will be loaded here -->
    </div>
    
    <script>
        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                patientId: params.get('patientId'),
                primaryColor: params.get('primaryColor') || '#57CC99',
                textColor: params.get('textColor') || '#212121',
                backgroundColor: params.get('backgroundColor') || '#FBFBFB',
                cardBackground: params.get('cardBackground') || '#ffffff',
                borderColor: params.get('borderColor') || '#e0e0e0',
                successColor: params.get('successColor') || '#00b894',
                warningColor: params.get('warningColor') || '#ff9800',
                dangerColor: params.get('dangerColor') || '#ff6b6b',
                apiKey: params.get('apiKey')
            };
        }
        
        // Apply theme
        function applyTheme() {
            const params = getUrlParams();
            document.documentElement.style.setProperty('--primary-color', params.primaryColor);
            document.documentElement.style.setProperty('--text-color', params.textColor);
            document.documentElement.style.setProperty('--bg-color', params.backgroundColor);
            document.documentElement.style.setProperty('--card-bg', params.cardBackground);
            document.documentElement.style.setProperty('--border-color', params.borderColor);
            document.documentElement.style.setProperty('--success-color', params.successColor);
            document.documentElement.style.setProperty('--warning-color', params.warningColor);
            document.documentElement.style.setProperty('--danger-color', params.dangerColor);
        }
        
        // Sample data
        const patientData = {
            patient1: {
                name: 'Wayan Bagus',
                phone: '+62 896-0588-0609',
                dob: '29.09.2006',
                address: '72129 Bartoletti Highway, 4',
                email: 'wBagus@gmail.com',
                photo: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150',
                schedules: [
                    {
                        id: 1,
                        medication: 'Paracetamol',
                        diagnosis: 'Hipertensi',
                        time: '09:00 AM',
                        dose: '1 Tablet',
                        instruction: 'After Meal',
                        frequency: '3x per day'
                    },
                    {
                        id: 2,
                        medication: 'Amoxicillin',
                        diagnosis: 'Infeksi',
                        time: '02:00 PM',
                        dose: '500mg',
                        instruction: 'Before Meal',
                        frequency: '2x per day'
                    },
                    {
                        id: 3,
                        medication: 'Vitamin C',
                        diagnosis: 'Suplemen',
                        time: '08:00 PM',
                        dose: '1000mg',
                        instruction: 'After Meal',
                        frequency: '1x per day'
                    }
                ]
            },
            patient2: {
                name: 'Bagus Wayan',
                phone: '+62 812-3456-7890',
                dob: '15.03.1998',
                address: '45678 Green Valley Street, 12',
                email: 'BWayan@gmail.com',
                photo: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150',
                schedules: [
                    {
                        id: 4,
                        medication: 'Antasida',
                        diagnosis: 'Diare',
                        time: '11:00 AM',
                        dose: '2 Tablet',
                        instruction: 'After Meal',
                        frequency: '2x per day'
                    }
                ]
            },
            patient3: {
                name: 'Made Artha',
                phone: '+62 821-9876-5432',
                dob: '22.11.2000',
                address: '89012 Sunset Boulevard, 7',
                email: 'madeArtha@gmail.com',
                photo: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150',
                schedules: []
            }
        };
        
        // Load patient data
        function loadPatientData() {
            const params = getUrlParams();
            const patientId = params.patientId || 'patient1';
            const patient = patientData[patientId];
            
            if (patient) {
                document.getElementById('patientPhoto').src = patient.photo;
                document.getElementById('patientName').textContent = patient.name;
                document.getElementById('patientMeta').innerHTML = `
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M224.2 89C216.3 70.1 195.7 60.1 176.1 65.4L170.6 66.9C106 84.5 50.8 147.1 66.9 223.3C104 398.3 241.7 536 416.7 573.1C493 589.3 555.5 534 573.1 469.4L574.6 463.9C580 444.2 569.9 423.6 551.1 415.8L453.8 375.3C437.3 368.4 418.2 373.2 406.8 387.1L368.2 434.3C297.9 399.4 241.3 341 208.8 269.3L253 233.3C266.9 222 271.6 202.9 264.8 186.3L224.2 89z"/></svg>
                        ${patient.phone}
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/></svg>
                        ${patient.dob}
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M128 252.6C128 148.4 214 64 320 64C426 64 512 148.4 512 252.6C512 371.9 391.8 514.9 341.6 569.4C329.8 582.2 310.1 582.2 298.3 569.4C248.1 514.9 127.9 371.9 127.9 252.6zM320 320C355.3 320 384 291.3 384 256C384 220.7 355.3 192 320 192C284.7 192 256 220.7 256 256C256 291.3 284.7 320 320 320z"/></svg>
                        ${patient.address}
                    </div>
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M112 128C85.5 128 64 149.5 64 176C64 191.1 71.1 205.3 83.2 214.4L291.2 370.4C308.3 383.2 331.7 383.2 348.8 370.4L556.8 214.4C568.9 205.3 576 191.1 576 176C576 149.5 554.5 128 528 128L112 128zM64 260L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 260L377.6 408.8C343.5 434.4 296.5 434.4 262.4 408.8L64 260z"/></svg>
                        ${patient.email}
                    </div>
                `;
                
                loadSchedules(patient.schedules);
            }
        }
        
        // Load schedules
        function loadSchedules(schedules) {
            const scheduleList = document.getElementById('scheduleList');
            
            if (schedules.length === 0) {
                scheduleList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path fill="#ffff" d="M128 128C128 92.7 156.7 64 192 64L341.5 64C358.5 64 374.8 70.7 386.8 82.7L493.3 189.3C505.3 201.3 512 217.6 512 234.6L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 128zM336 122.5L336 216C336 229.3 346.7 240 360 240L453.5 240L336 122.5zM288 344L288 384L248 384C239.2 384 232 391.2 232 400L232 432C232 440.8 239.2 448 248 448L288 448L288 488C288 496.8 295.2 504 304 504L336 504C344.8 504 352 496.8 352 488L352 448L392 448C400.8 448 408 440.8 408 432L408 400C408 391.2 400.8 384 392 384L352 384L352 344C352 335.2 344.8 328 336 328L304 328C295.2 328 288 335.2 288 344z"/></svg>
                        </div>
                        <p>No medication schedules yet</p>
                    </div>
                `;
                return;
            }
            
            scheduleList.innerHTML = schedules.map(schedule => `
                <div class="schedule-item">
                    <div class="schedule-header">
                        <div>
                            <div class="medication-name">${schedule.medication}</div>
                            <span class="diagnosis">${schedule.diagnosis}</span>
                        </div>
                        <div class="schedule-time">${schedule.time}</div>
                    </div>
                    <div class="schedule-details">
                        <span class="detail-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M128 176C128 149.5 149.5 128 176 128C202.5 128 224 149.5 224 176L224 288L128 288L128 176zM64 176L64 464C64 525.9 114.1 576 176 576C237.9 576 288 525.9 288 464L288 358.2L404.3 527.7C439.8 579.4 509.6 592 560.3 555.8C611 519.6 623.3 448.3 587.8 396.6L459.3 209.3C423.8 157.6 354 145 303.3 181.2C297.7 185.2 292.6 189.6 288 194.3L288 176C288 114.1 237.9 64 176 64C114.1 64 64 114.1 64 176zM328.6 304.2C312.6 280.9 318.6 248.9 340.5 233.2C361.7 218.1 391 222.9 406.5 245.4L473.5 343L393.6 398.9L328.6 304.1z"/></svg>
                            ${schedule.dose}
                        </span>
                        <span class="detail-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M127.9 78.4C127.1 70.2 120.2 64 112 64C103.8 64 96.9 70.2 96 78.3L81.9 213.7C80.6 219.7 80 225.8 80 231.9C80 277.8 115.1 315.5 160 319.6L160 544C160 561.7 174.3 576 192 576C209.7 576 224 561.7 224 544L224 319.6C268.9 315.5 304 277.8 304 231.9C304 225.8 303.4 219.7 302.1 213.7L287.9 78.3C287.1 70.2 280.2 64 272 64C263.8 64 256.9 70.2 256.1 78.4L242.5 213.9C241.9 219.6 237.1 224 231.4 224C225.6 224 220.8 219.6 220.2 213.8L207.9 78.6C207.2 70.3 200.3 64 192 64C183.7 64 176.8 70.3 176.1 78.6L163.8 213.8C163.3 219.6 158.4 224 152.6 224C146.8 224 142 219.6 141.5 213.9L127.9 78.4zM512 64C496 64 384 96 384 240L384 352C384 387.3 412.7 416 448 416L480 416L480 544C480 561.7 494.3 576 512 576C529.7 576 544 561.7 544 544L544 96C544 78.3 529.7 64 512 64z"/></svg>
                            ${schedule.instruction}
                        </span>
                        <span class="detail-badge">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20"><path d="M224 64C241.7 64 256 78.3 256 96L256 128L384 128L384 96C384 78.3 398.3 64 416 64C433.7 64 448 78.3 448 96L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 96C192 78.3 206.3 64 224 64zM160 304L160 336C160 344.8 167.2 352 176 352L208 352C216.8 352 224 344.8 224 336L224 304C224 295.2 216.8 288 208 288L176 288C167.2 288 160 295.2 160 304zM288 304L288 336C288 344.8 295.2 352 304 352L336 352C344.8 352 352 344.8 352 336L352 304C352 295.2 344.8 288 336 288L304 288C295.2 288 288 295.2 288 304zM432 288C423.2 288 416 295.2 416 304L416 336C416 344.8 423.2 352 432 352L464 352C472.8 352 480 344.8 480 336L480 304C480 295.2 472.8 288 464 288L432 288zM160 432L160 464C160 472.8 167.2 480 176 480L208 480C216.8 480 224 472.8 224 464L224 432C224 423.2 216.8 416 208 416L176 416C167.2 416 160 423.2 160 432zM304 416C295.2 416 288 423.2 288 432L288 464C288 472.8 295.2 480 304 480L336 480C344.8 480 352 472.8 352 464L352 432C352 423.2 344.8 416 336 416L304 416zM416 432L416 464C416 472.8 423.2 480 432 480L464 480C472.8 480 480 472.8 480 464L480 432C480 423.2 472.8 416 464 416L432 416C423.2 416 416 423.2 416 432z"/></svg>
                            ${schedule.frequency}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Navigation functions
        function navigateBack() {
            sendMessage('navigate', { view: 'dashboard' });
        }
        
        function navigateToAddPrescription() {
            const params = getUrlParams();
            sendMessage('navigate', { 
                view: 'add-prescription',
                patientId: params.patientId 
            });
        }
        
        // Send message to parent
        function sendMessage(type, data) {
            window.parent.postMessage({ type, ...data }, '*');
        }
        
        // Send resize message
        function sendResize() {
            const height = document.body.scrollHeight;
            sendMessage('resize', { height });
        }
        
        // Initialize
        applyTheme();
        loadPatientData();
        
        // Send initial resize
        setTimeout(sendResize, 100);
        
        // Resize observer
        new ResizeObserver(sendResize).observe(document.body);
    </script>
</body>
</html>